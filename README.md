# Blender-Render-Farm

**Abstract** -- Primitive implementation of Blender render farm by Dr. Hatuki.

## 1. Introduction

### 1.1 Features

This repository is basically a support for accelerating the Iroha-Von-Schale, a dataset rendering pipeline implementation with Blender. 

We started this project based on the fact that quite a lot of time had been wasted on copying, pasting and sorting out the files and runtime enviroments through different machines.

We mark our render farm with following features:

+ Support on Blender as python module `bpy`.

### 1.2 Structure

There are three components of the farm. 

|Name|Description|
|:---:|:---:|
|farm-client|Console app for convenience in uploading a task.|
|farm-server|Flask app for task collecting and assignment.|
|farm-worker|Console app for rendering with bpy-module.|

### 1.3 Deployments

**Using source code.** Download the source code in folder `src` for each farm component to the desired machines. We include conda and pip requirements file in each farm component. 

+ Note: There are differences in 3rd-party module dependencies.

Running the code. Before running the code, you need to change the present working directory to `src/farm-master` or `src/farm-client` to prevent unexpected exception from happening.


## 2. Task Arrangement

In this section, we shall introduce the task arrangement for blender-render-farm.

### 2.1 File Preparation

We insist the structure of file folder be arranged as demanded. There are two supported tasks, one is rendering with customed `bpy-scripts`, the other one is rendering with single `.blend` file. You could include your project files into a root file, for example `root_folder` in following paragraphs.

For those who offer a python script, the folder is supposed to be like following:

```sh
# Render with bpy.
root_folder
     |-- blend
     |    |-- addons/
     |    |-- assets/
     |    |-- outputs/         [Required]
     |    |-- __init__.py      [Required]
     |    |-- main.py          [Required]
     |    ...
     |
     |-- config.json           [Required]
     ...
```

Once the farm-client is executed, the folder `root_folder/blend` shall be packed up and uploaded to farm-master server. The host and port of the server is configured in `root_folder/config.json` with priority or `root_folder/config.yml` with second order.

For rendering without `bpy`, we suppose a texture folder for finding missing textures automatically by our farm workers.

```sh
# Render without bpy.
root_folder
     |-- blend
     |    |-- main.blend        [Required]
     |    |-- textures/
     |    ...
     |
     |-- config.json            [Required]
```

We insist the `.blend` file be renamed for our worker to recognize.

You can find an example blend folder in the [blend folder]() right under the root of this repository.

Note there must be an `__init__.py` and a `main.py` as entry point for `farm-worker` to locate. And put down the core logic in `main.py`. 

Put `.blend` files in assets folder.


## üëè Acknowledgements

+ Some of the scripts are inspired by [Microsoft Copilot](https://copilot.microsoft.com/). 
+ Some of the comments in the scripts of this project are generated by the other project [hatuki-block-commentator](https://github.com/HanyoVladScarlet/hatuki-block-commentator).
+ I sincerely appreciate the kindness of my colleague [Zhangxi](https://github.com/Dreamupers) for technique support while bearing my awful temper during the development, with highest respect.